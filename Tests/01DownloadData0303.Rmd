---
title: "01DownloadData"
author: "MiriamLerma"
date: "03/3/2022"
output: html_document
editor_options: 
  markdown: 
    wrap: sentence
---

# Intro

Twelve white storks were tagged. GPS data was directly downloaded from movebank, using the function getMovebankLocationData from the package 'move'.


In this RMD the code:
- Access data from movebank
- Downloads data per individual
- Check latitutes per individual
- Check map per individual
- Export csv of all data per individual
*Time to run*: aprox. 17 minutes

## January
JS: As I only need to analyse the data between April/May and August for each year, would it be a possibilty to download only the data from these time periods or could that mess up something?
I think I should be able to open a file including only this data.
As I think that I can not download data from movebank from different time periods in one download-session, I probably would need to make three downloads (April/May-August 2019, 2020, and 2021) and then put all of the data in one Excel file.
Could that lead to problems?
Or, in that case, would it be better to analyse each dataset on its own?

ML: Hello Jana, Three downloads would be a good idea, but while checking the data I notice the birds start moving sometimes earlier than April and also keep moving after august.
Please check out the outputs below.

## February
ML: Instead of downloading per periods, I downloaded all the data per individual

## March
ML: I re runn all the download data, because WS09 and WS11 were too similar.

# Packages

```{r}
library('move')
```

```{r}
library(tidyverse)
library(beepr)
library(here)
```

## Login

```{r}
loginStored<-movebankLogin(username = "JStuenkel", password = "Janawillrein123!")
```

<https://cran.r-project.org/web/packages/move/vignettes/browseMovebank.html>

```{r}
my_study<-'NABU FTZ White Stork Hamburg'
```



# Functions

```{r europe, include=FALSE, echo=FALSE}
library(sf) #st_read
World_shp <- st_read(here("./1Data/GIS/TM_WORLD_BORDERS-0.3.shp"))
```

```{r}
BaseMap<-ggplot()+
   geom_sf(data = World_shp, 
                 colour = "#495057", 
                 fill = "#ced4da",
                 size=0.5)+
  theme_bw()+
  theme(legend.position = 'none')
```


# ~~~~~~~~~~~~~~~~~~~~~~~

# Data

Check information

```{r}
Information<-getMovebankAnimals(study=my_study,login=loginStored)
```

24 individuals were tagged

## Check data

```{r}
Referencia<-getMovebankReferenceTable(study=my_study,login=loginStored)
```

24 individuals and two NAs

Select individuals

```{r}
Referencia<-as.data.frame(Referencia)
Referencia$tstamp<-as.POSIXct(strptime(Referencia$deploy_on_timestamp,"%Y-%m-%d %H:%M:%S"),"GMT")
```

Range of the deployments

```{r}
range(Referencia$tstamp,na.rm=TRUE)
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data")
write_csv(
  Referencia,
  file =paste0(DataFolder,'/01Referencia.csv'))
```



# WhiteStork-Hamburg-01
Downloads data per individual, takes around 1 minute
```{r}
WS_01<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-01',
                               #timestamp_start="201904010000000",
                               #timestamp_end="20190531000000000",
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_01$timestamp)
WS_01_range<-data.frame(id='WS_01',
                        start=min(WS_01$timestamp),
                        end=max(WS_01$timestamp))
```

"2019-05-23 13:00:10 UTC" "2021-08-23 18:01:19 UTC"

```{r}
ggplot(WS_01, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_01, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-01")
```


```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_01,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-01.csv'))
```

# WhiteStork-Hamburg-02

```{r}
WS_02<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-02',
                               #timestamp_start="201401010000000",
                               #timestamp_end="20141201000000000",
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_02$timestamp)
WS_02_range<-data.frame(id='WS_02',
                        start=min(WS_02$timestamp),
                        end=max(WS_02$timestamp))
```

```{r}
ggplot(WS_02, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_02, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-02")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_02,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-02.csv'))
```



# WhiteStork-Hamburg-03

```{r}
WS_03<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-03',
                               #timestamp_start="201401010000000",
                               #timestamp_end="20141201000000000",
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range *Note* Is weird that has a NA for 2031

```{r}
range(WS_03$timestamp)
WS_03_range<-data.frame(id='WS_03',
                        start=min(WS_03$timestamp),
                        end=max(WS_03$timestamp))
```

Clean Nas

```{r}
WS_03<-WS_03 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_03, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_03, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-03")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_03,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-03.csv'))
```


# WhiteStork-Hamburg-04

```{r}
WS_04<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-04',
                               #timestamp_start="201401010000000",
                               #timestamp_end="20141201000000000",
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_04$timestamp)
WS_04_range<-data.frame(id='WS_04',
                        start=min(WS_04$timestamp),
                        end=max(WS_04$timestamp))
```

Clean Nas

```{r}
WS_04<-WS_04 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_04, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_04, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-04")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_04,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-04.csv'))
```


# WhiteStork-Hamburg-05

```{r}
WS_05<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-05',
                               #timestamp_start="201401010000000",
                               #timestamp_end="20141201000000000",
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_05$timestamp)
WS_05_range<-data.frame(id='WS_05',
                        start=min(WS_05$timestamp),
                        end=max(WS_05$timestamp))
```

Clean Nas

```{r}
WS_05<-WS_05 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_05, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_05, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-05")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_05,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-05.csv'))
```


# WhiteStork-Hamburg-06

```{r}
WS_06<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-06',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_06$timestamp)
WS_06_range<-data.frame(id='WS_06',
                        start=min(WS_06$timestamp),
                        end=max(WS_06$timestamp))
```

Clean Nas

```{r}
WS_06<-WS_06 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_06, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_06, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-06")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_06,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-06.csv'))
```

# WhiteStork-Hamburg-07

```{r}
WS_07<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-07',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_07$timestamp)
WS_07_range<-data.frame(id='WS_07',
                        start=min(WS_07$timestamp),
                        end=max(WS_07$timestamp))
```

Clean Nas

```{r}
WS_07<-WS_07 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_07, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_07, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-07")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_07,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-07.csv'))
```


# WhiteStork-Hamburg-08

```{r}
WS_08<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-08',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_08$timestamp)
WS_08_range<-data.frame(id='WS_08',
                        start=min(WS_08$timestamp),
                        end=max(WS_08$timestamp))
```

Clean Nas

```{r}
WS_08<-WS_08 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_08, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_08, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-08")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_08,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-08.csv'))
```


# WhiteStork-Hamburg-09

```{r}
WS_09<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-09',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_09$timestamp)
WS_09_range<-data.frame(id='WS_09',
                        start=min(WS_09$timestamp),
                        end=max(WS_09$timestamp))
```

Clean Nas

```{r}
WS_09<-WS_09 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_09, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_09, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-09")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_09,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-09.csv'))
```

# WhiteStork-Hamburg-10

```{r}
WS_10<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-10',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_10$timestamp)
WS_10_range<-data.frame(id='WS_10',
                        start=min(WS_10$timestamp),
                        end=max(WS_10$timestamp))
```

Clean Nas

```{r}
WS_10<-WS_10 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_10, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-10, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_10, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-10, 70))+
  ggtitle("WhiteStork-Hamburg-10")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_10,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-10.csv'))
```

# WhiteStork-Hamburg-11

```{r}
WS_11<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-11',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_11$timestamp)
WS_11_range<-data.frame(id='WS_11',
                        start=min(WS_11$timestamp),
                        end=max(WS_11$timestamp))
```

Clean Nas

```{r}
WS_11<-WS_11 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_11, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-11, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_11, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-11, 70))+
  ggtitle("WhiteStork-Hamburg-11")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_11,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-11.csv'))
```


# WhiteStork-Hamburg-12

```{r}
WS_12<-getMovebankLocationData(study=my_study, 
                               login=loginStored, 
                               individual_local_identifier='WhiteStork-Hamburg-12',
                               sensorID="GPS")
beep(sound=1,expr=NULL)
```

Check time range

```{r}
range(WS_12$timestamp)
WS_12_range<-data.frame(id='WS_12',
                        start=min(WS_12$timestamp),
                        end=max(WS_12$timestamp))
```

Clean Nas

```{r}
WS_12<-WS_12 %>%
  drop_na(location.long)
```

```{r}
ggplot(WS_12, aes(x = timestamp, y = location.lat)) + 
    geom_line(color='red')+
  scale_x_datetime(date_labels = "%b %d %Y",date_breaks = "1 month")+
  scale_y_continuous(limits=c(-12, 60))+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1))
```

```{r}
BaseMap+geom_point(data = WS_12, 
             aes(x=location.long, 
                 y = location.lat),
                 size = 0.5,
             color='red') + 
  coord_sf(xlim = c(-20, 40), ylim = c(-12, 70))+
  ggtitle("WhiteStork-Hamburg-12")
```

```{r, eval=FALSE}
DataFolder<-here::here("1Data/01Birds")
write_csv(
  WS_12,
  file =paste0(DataFolder,'/WhiteStork-Hamburg-12.csv'))
```


# End of document