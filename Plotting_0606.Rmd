---
title: "Plotting"
author: "Miriam Lerma"
date: "June 2023"
output:
  xaringan::moon_reader:
    css: RZero-themer.css
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      
---

class: title-slide, bottom, right
background-image: url(https://images.unsplash.com/photo-1570386230314-9fe8204c6f80?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1108&q=80)
background-size: cover

### `r rmarkdown::metadata$title`
# `r rmarkdown::metadata$subtitle`

### **`r rmarkdown::metadata$author`**<br>
`r rmarkdown::metadata$date`

---

name: index
class: title-slide, inverse

```{r, echo=FALSE, include = FALSE}
#Paquetes
library(xaringanExtra)
library(kableExtra)
library(fontawesome)
library(emo)
```

# Index

- [scatterplot](#scatterplot)
- [lines](#lines)
- [boxplot](#boxplot)
- [trajectory](#trajectories)
- [maps](#maps)
- [theme](#theme)
- [legend](#legend)
- [custome maps](#custom-map)
- [export](#export) 

---

class: title-slide, inverse

# Today

.pull-left[

**Your profile**
- You know how to use a Rmd document
- You know how to install packages


**Goals of today**

- Create plots and maps in R
- Change the apparence of the plots
- Export you plots

**Pauses and questions**

- Exercises and 10 minute pauses for catching up
- You can stop me to ask questions or use [this link `r fa("external-link-alt", fill = "#f2cc8f")`]( https://docs.google.com/document/d/1uG7a2_hkdaKQm5gKXRBFf6gcyoUBan2e69gL3ZKcwg8/edit?usp=sharing)

]

.pull-right[
We will use the packages

```{r,eval=FALSE}
# install.packages('tidyverse')
# install.packages("devtools")
devtools::install_github("MiriamLL/sula")
devtools::install_github("MiriamLL/GermanNorthSea")
install.packages('sf')
```
]

---

class: inverse

# References

Tutorials/Books  

- [gg is for Grammar of Graphics](https://pkg.garrickadenbuie.com/trug-ggplot2)<br>

- [Introduccion to ggplot](https://englelab.gatech.edu/useRguide/introduction-to-ggplot2.html)  

- [r4ds](https://r4ds.had.co.nz/data-visualisation.html)

- [Geocomputation with R](https://r.geocompx.org/attr.html)

- [R Graphics Cookbook](https://r-graphics.org/)

Gallery/Portafolios

- [Data-Viz-Bookmarks](https://spcanelon.notion.site/spcanelon/Data-Viz-Bookmarks-dc01718020bd4fd6a8a4ca80e6bce933)<br>

- [RGraphGallery](https://www.r-graph-gallery.com/) <br>

- [DataToViz](https://www.data-to-viz.com/) <br>

- [Coolors](https://coolors.co/) <br>

---
name: theory

## 1.1. Theory

The objective of a graph/plot/map is to communicate. <br>
In science, the idea is to show information in a clear and understandable way. 

```{r echo=FALSE, out.height=350}
knitr::include_graphics("http://www.typesofgraphs.com/wp-content/uploads/2015/12/Typesofgraphs.png")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

Plotting is transforming data to visualizations that vary in shape, size and colors.

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_1.jpg")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

There are many ways to plot data, and different ways to interpretate the graphs.

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_2.jpg")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)


---

## 1.1. Theory

Which one is more intuitive?

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_4.jpg")
```

Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

Which one should I use?

You can try different plots and choose the one that betters tells the story.

**Tableau Public** has a suggestion on which graph to use according to the type of data you are using.

```{r echo=FALSE, out.height=300}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_5.jpg")
```

---

name: intro

## 1.2. Intro

There are many packages to create plots in R.
- Here we will use **ggplot2**.


ggplot is the most versatile one, and from which you can find more help and inspiration.

---

## 1.2. Intro

A graph can be divided in three main components:

- **Data** (data): which are the variables that we plot.
- **Geometry** (geom): a geometric object such as dots, lines, bars.
- **Aesthetics** (aes): the aesthetic attributes to a geometric object, such as position, color, shape and size. 
  

Each component is displayed as **layers** like in GIS (Geographic information systems).

```{r echo=FALSE, out.height=200}
knitr::include_graphics("https://englelab.gatech.edu/useRguide/images/dataviz/ge_geom.png")
```
  

Fuente: [ggplot2 book](https://englelab.gatech.edu/useRguide/working-with-data-overview.html)

---

## 1.3. Data

```{r xaringanExtra-clipboard, echo=FALSE}
xaringanExtra::use_clipboard()
```

The package ggplot is already included in tidyverse. <br> If you have installed tidyverse you just need to call your package.

```{r, eval=FALSE}
library(tidyverse)
```

If not you can also install it separately. 
```{r, eval=FALSE}
install.packages("ggplot2")
```

---

## 1.3. Data

For the exercises, we can use data from packages.<br>
Lets add our object to our **environment**

Package with data
```{r}
library(palmerpenguins)
penguins<-penguins
```

Call library **ggplot2**

```{r}
library(ggplot2)
```

---

## 1.3. Data

First step: add data to a plot

```{r, echo=TRUE, fig.width=6, fig.height=4}
ggplot(data=penguins)
```


We told ggplot what data frame we want to use, but we didnt give instructions on what we want to plot. <br>

---

## 1.3. Add axis

Using **mapping**  we tell ggplot what to plot in the x and y axis.<br>

Note that the axis are columns from your data frame.

```{r, fig.width=6, fig.height=4}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm, #<<
                   y=bill_depth_mm)) #<<
```


---

## 1.3. Geometry

The next step is to give it a geometry, in this case we say plot points with the argument **geom_point**

```{r, fig.width=6, fig.height=4, warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
       geom_point() #<<
```

It would likely show a **warning** <br>
This is because NAs are not going to be plotted and R is trying to warn you.


---

## 1.4. Different geometries

There are many **geometries**

Most, if not all, of them start with geom_*

```{r echo=FALSE, out.height=300}
knitr::include_graphics("https://github.com/MiriamLL/R_intro/blob/master/Images/302geometries.png?raw=true")
```


---

## 1.4. Different geometries

Examples are to be found on [R-graph-gallery](https://r-graph-gallery.com/)

```{r, echo=FALSE, out.height=100}
knitr::include_graphics("https://github.com/MiriamLL/R_intro/blob/master/Images/302examples.png?raw=true")
```

```{r, echo=FALSE, out.height=200}
knitr::include_graphics("https://github.com/MiriamLL/R_intro/blob/master/Images/303examples.png?raw=true")
```

---
name: scatterplot

## 1.4. Scatterplots

The scatterplot is most useful for displaying the relationship between two continuous variables. Each dot represents an observation. Their position on the X (horizontal) and Y (vertical) axis represents the values of the 2 variables. 

The argument to create scatterplots is **geom_point**

```{r, fig.width=6, fig.height=4, warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_point() #<<
```

[See more scatterplots](https://r-graph-gallery.com/scatterplot.html)

---
name: lines

## 1.4. Line chart

A line chart or line graph displays the evolution of one or several numeric variables. <br>
Data points are connected by straight line segments. 

The argument to create line charts is **geom_line()** 

```{r, fig.width=6, fig.height=4, warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_line() #<<
```

[See more lineplots](https://r-graph-gallery.com/line-plot.html)


---

name: barplot

## 1.4. Barplot

A barplot is used to display the relationship between a numeric and a categorical variable.<br>

The argument to create barplots is **geom_bar()** 

```{r, fig.height=3,warning=FALSE, eval=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_bar() #<<
```
Error: stat_count() can only have an x or y aesthetic.

---

## 1.4. Barplot

Different from the logic of the previous plots, we need to tell what do you want inside the bars by adding **stats=**.

```{r, fig.width=6, fig.height=4,warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_bar(stat='identity') #<<
```

[See more barplots](https://r-graph-gallery.com/barplot.html)

---

name: boxplot

## 1.4. Boxplot

Boxplot is probably the most commonly used chart type to compare distribution of several groups.<br>

It visualises five summary statistics (the median, two hinges and two whiskers), and all "outlying" points individually.

```{r, echo=FALSE, out.height=200}
knitr::include_graphics("https://github.com/MiriamLL/R_intro/blob/master/Images/305boxplot.png?raw=true")
```

Source: [Boxplot explanation](https://www.leansigmacorporation.com/box-plot-with-minitab/)

---

## 1.4. Boxplot

The boxplot compactly displays the distribution of a continuous variable. 

The argument **geom_boxplot** is to be used.

```{r, fig.width=6, fig.height=4,echo=TRUE, warning=FALSE}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_boxplot() #<<
```


---

## 1.4. Boxplot

Often we will like to visualize differences between groups. Using the argument **group=* inside mapping to create boxplots per group.

```{r, fig.width=6, fig.height=4, warning=FALSE}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm,y=bill_depth_mm, 
                   group=species))+#<<
  geom_boxplot() 
```

[See more boxplots](https://r-graph-gallery.com/boxplot.html)

---

name: trajectory

## 1.4. Trajectory

**Definition of trajectory** the path followed by a projectile flying or an object moving under the action of given forces.

For the exercise, lets load data from the package **sula**

```{r, warning=FALSE}
#devtools::install_github("MiriamLL/sula")
library(sula)
```

Get data in the environment
```{r}
tracking_data<-sula::GPS_raw
```

Data contains the columns **Latitude** and **Longitude**
```{r}
head(tracking_data,5)
```

---

## 1.4. Trajectory

To plot trajectories, the argument **geom_path** is to be used.

geom_path() connects the observations in the order in which they appear in the data.

```{r, fig.width=6, fig.height=4,echo=TRUE, eval=TRUE}
ggplot(data = tracking_data, aes(x = Latitude, y = Longitude)) +
  geom_path() #<<
```

---

name: maps

## 1.4. Maps

R is an great tool for geospatial data analysis. 

The book [Geocomputation with R](https://r.geocompx.org/attr.html) is a great guide.

```{r echo=FALSE, out.height=300}
knitr::include_graphics("https://github.com/MiriamLL/R_intro/blob/master/Images/306Book.png?raw=true")
```

---

## 1.4. Maps

For today exercises, install **GermanNorthSea**

This package compiles shapefiles from the North Sea

```{r, warning=FALSE}
#devtools::install_github("MiriamLL/GermanNorthSea")
library(GermanNorthSea)
```

To see the containing shapefiles go to my [github](https://github.com/MiriamLL/GermanNorthSea)

To add shapefile to environment

```{r}
German_land<-German_land
```

Note that a **sf** object is different from a data frame, if we click on the object is not clear what it contains.

```{r}
class(German_land)
```

---

## 1.4. Maps

To plot **sf** (simple features) objects, the argument **geom_sf** is to be used

geom_sf() uses a unique aesthetic: geometry, giving an column of class sfc containing simple features data. 

```{r, fig.width=6, fig.height=4,echo=TRUE}
ggplot(German_land)+ 
  geom_sf()
```

---

## 1.4. Maps

The argument **coord_sf()** ensures that all layers use a common CRS. You can either specify it using the crs param, or coord_sf() will take it from the first layer that defines a CRS.

**Here I know I am using 3035**. Thus, my **xlim** and my **ylim** are in those units.

```{r,fig.width=6, fig.height=4}
ggplot(German_land)+ 
  geom_sf()+
  coord_sf(xlim = c(3790000,4250000), ylim = c(3350000,3680000))
```

---

## 1.4. Maps

Other common CRS (Coordinate Reference System) is 4326.

To transform our shapefile to other coordinate system **st_transform** from the package **Sf** can be used.

```{r}
German_land<-sf::st_transform(German_land, 4326)
```

Now the xlim and ylim can be in degrees.

```{r,fig.width=6, fig.height=4}
ggplot(German_land)+ 
  geom_sf()+
  coord_sf(xlim = c(3,9), ylim = c(53,56))
```

---

class: inverse

# Pause

.pull-left[
Practice `r fa("pencil-alt", fill = '#FFFFFF')`

]

.pull-right[
Until here:
- [index](#index)
- [theory](#theory)
- [scatterplot](#scatterplot)
- [line chart](#lines)
- [barplot](#barplot)
- [trajectory](#trajectory)
- [maps](#maps)

Next part:
- [aesthetics](#export) 
- [export](#out)
- [contact](#contact)
]

---

name: aesthetics
class: title-slide, inverse, right, middle
background-image: url(https://images.unsplash.com/photo-1460661419201-fd4cecdf8a8b?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=580&q=80)
background-size:cover

# 2. Aesthetics

---
 
 
 
 
 
## 2. Aesthetics

```{r}

```



---

## 2.1. Symbol color

Using colour to visualise additional variables

If you wish to colour point on a scatterplot by a third categorical variable, then add colour = variable.name within your aes brackets. This tells ggplot that this third variable will colour the points. 

```{r,fig.width=6, fig.height=4, echo=TRUE, warning=FALSE}
ggplot(data=penguins, mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+ #<<
  geom_point()
```


---

## 2.2. Theme

```{r,fig.width=6, fig.height=4, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+ 
  geom_point()+
  theme_bw() #<<
```

---

## 2.3. Background colors

```{r,fig.width=6, fig.height=4, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  theme(panel.background = element_rect(fill = 'darkblue'))#<<
```

---

## 2.4. Axis legends

```{r,fig.width=6, fig.height=4, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  xlab('Bill lenght')+ylab('Flipper length')#<<
```


---

## 2.5. Font size

```{r,fig.width=6, fig.height=4, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  theme(axis.title = element_text(size=20)) #<<
```

---

## 2.6. Legends

```{r,fig.width=6, fig.height=4, echo=TRUE, warning=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  theme(legend.position = "top") #<<
```

---

## 2.7 Cheat sheet

Help>CheatSheets>Data Visualization with ggplot

---

## 2.8. Common mistakes

Not having **tidydata**  
 

```{r echo=FALSE, out.width=600}
knitr::include_graphics('https://r4ds-en-espaniol.netlify.app/diagrams_w_text_as_path/es/visualization-stat-bar.svg')
```
  
Fuente: [R4DS](https://r4ds-en-espaniol.netlify.app/) 

---

## 2.8. Common mistakes

Forgetting a plus symbol ( **+** )

```{r, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))
  geom_point()
```

--

Adding the **+** on the wrong order
```{r, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))
 +geom_point()
```

--

Forgetting a parethesis

```{r, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species)+ #<<
         geom_point()
```
Add a parenthesis after "species"

---

## 2.9. Plot as an object

You can save your plot as an object in the environment

```{r, echo=TRUE}
My_plot<-ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+ 
  geom_point()
```

```{r}
My_plot
```

Yo can add aesthetics to the object using the **+**
```{r, fig.height=3, echo=TRUE, eval=FALSE}
My_plot+ #<<
  theme_bw()+
  theme(legend.position = "top")
```


---

## 2.10. Simplify 

So far we always wrote data= and mapping= <br>

However, you can skip it if you follow the same order.

No necesitan escribir todo (data, mapping se puede omitir) si siguen un orden.
```{r, echo=TRUE, eval=FALSE}
My_plot<-ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()
My_plot
```


---

name: custom-maps
background-image: url(https://images.unsplash.com/photo-1554033551-050e208bcaf2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=800)
background-size: cover

# 3. Maps

---

## 3.1. Basic Map

```{r, eval=FALSE}
1. Getting ready

You can download shapefiles from: https://www.naturalearthdata.com/downloads/

Call the package here to work in your directory.

library(here)

Call the package sf to read the shapefiles into R

library(sf)

2. Read your shapefile

Use your directory name, and give the name of your shapefile

Europe<-st_read(paste0(Directory,MyShapefileName))

Reading layer `country' from data source 
  `C:\Users\lerma\OneDrive\Documents\4Programacion\2023\1Distill\Distill\_posts\2023-03-04-mapping-in-r\country.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 54 features and 2 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: -31.26575 ymin: 32.39748 xmax: 69.07032 ymax: 81.85737
Geodetic CRS:  WGS 84

3. Create a basic map

Load ggplot2

library(ggplot2)

Plot your shapefile

ggplot()+  
  geom_sf(data = Europe)

4. Add colors

I copy the hex colors from coolors

ggplot()+  
  geom_sf(data = Europe, 
          colour = "#edf2f4", 
          fill = "#2b2d42",
          size=0.5)

5. Change background color

You can eliminate the grids and the change the background color in ggplot

ggplot()+  
  geom_sf(data = Europe, 
          colour = "#edf2f4", 
          fill = "#2b2d42",
          size=0.5)+
  theme(
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = '#edf2f4'),
        legend.background = element_rect(fill = '#edf2f4'))

6. Add limits

Reduce to focus in your area of interest

ggplot()+  
  geom_sf(data = Europe, 
          colour = "#edf2f4", 
          fill = "#2b2d42",
          size=0.5)+
  theme(
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = '#edf2f4'),
        legend.background = element_rect(fill = '#edf2f4'))+
  
  coord_sf(xlim = c(9, 31),ylim = c(53, 65))

7. Add scale

Load the package ggspatial to add a scale and an north arrow

library(ggspatial)

br is from bottom right
bar_cols is for column colors
text_col is for the color of the text

ggplot()+  
  geom_sf(data = Europe, 
          colour = "#edf2f4", 
          fill = "#2b2d42",
          size=0.5)+
  theme(
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = '#edf2f4'),
        legend.background = element_rect(fill = '#edf2f4'))+
  
  coord_sf(xlim = c(9, 31),ylim = c(53, 65))+
    scale_x_continuous(labels = function(x) paste0(x, '\u00B0', "W")) +
    scale_y_continuous(labels = function(x) paste0(x, '\u00B0', "N")) +
  
  annotation_scale(location = "br",bar_cols = c("#ef233c", "#d90429"),text_col = '#ef233c')

8. Add arrow

tl is for top left
which_north preferably true (see why here)
north_arrow_fancy_orienteering (see other styles here)

ggplot()+  
  geom_sf(data = Europe, 
          colour = "#edf2f4", 
          fill = "#2b2d42",
          size=0.5)+
  theme(
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(fill = '#edf2f4'),
        legend.background = element_rect(fill = '#edf2f4'))+
  
  coord_sf(xlim = c(9, 31),ylim = c(53, 65))+
    scale_x_continuous(labels = function(x) paste0(x, '\u00B0', "W")) +
    scale_y_continuous(labels = function(x) paste0(x, '\u00B0', "N")) +
  
   annotation_scale(location = "br",bar_cols = c("#ef233c", "#d90429"),text_col = '#ef233c')+
  
  annotation_north_arrow(location = "tl", style = north_arrow_minimal(text_col = '#ffd60a',line_col = '#ffd60a',fill = '#ffd60a')) 

Thats it for now!
```


---

## 3.2. Add dots

```{r, eval=FALSE}

library(tidyverse)
library(seamonas)

## Create data frame
density_df<-data.frame(
             seq=(1:50),
             survey_id=rep(c(1, 2, 3, 4, 5), each = 10),
             longitude=c(seq(6, 8, length = 10),
                         seq(6, 8, length = 10),
                         seq(6, 8, length = 10),
                         seq(6, 8, length = 10),
                         seq(6, 8, length = 10)),
             latitude=c(seq(55.1,54, length = 10),
                        seq(55.1+0.1,54+0.1, length = 10),
                        seq(55.1+0.2,54+0.2, length = 10),
                        seq(55.1-0.2,54-0.2, length = 10),
                        seq(55.1-0.1,54-0.1, length = 10)),
             timestamps=c(
  head(seq.POSIXt(as.POSIXct("2018-04-01 09:00:00"), as.POSIXct("2018-04-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-05-01 09:00:00"), as.POSIXct("2018-05-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-06-01 09:00:00"), as.POSIXct("2018-06-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-07-01 09:00:00"), as.POSIXct("2018-07-01 18:00:00"), by="min"), 10),
  head(seq.POSIXt(as.POSIXct("2018-08-01 09:00:00"), as.POSIXct("2018-08-01 18:00:00"), by="min"), 10))
)


density_df$year<-stringr::str_sub(density_df$timestamps, 1, 4)
density_df$month<-stringr::str_sub(density_df$timestamps, 6, 7)
density_df$day<-stringr::str_sub(density_df$timestamps, 9, 10)
density_df$date<-paste0(density_df$year,"-",density_df$month,"-",density_df$day)

density_df<-density_df

ggplot()+
  geom_point(data=density_df,
          aes(x = longitude,
              y= latitude))

#values 0 or 1
random1<-sample(0:1, 50, replace=TRUE)

#values 0 to 5.1

random2<-runif(50, min=0, max=5.1)

#make data frame

random3<-cbind(random1,random2)
random3<-as.data.frame(random3)


#substitute values
random4<-random3 %>%
  mutate(random5 = case_when(
    random1 == 0 ~ 0,
    random1 != 0 ~ random2,
    TRUE ~ random2))
#use as densities

density_df$densities<-as.numeric(random4$random5)

range(density_df$densities)

class0<-0
class1<-1
class2<-2.5
class3<-5

density_df<-density_df %>% 
    mutate(density_class = case_when(
      densities ==  class0 ~ as.character("group0"),
      densities >=  class0 & densities <=  class1 ~ as.character("group1"),
      densities >=  class1 & densities <=  class2 ~ as.character("group2"),
      densities >=  class2 & densities <=  class3 ~ as.character("group3"),
      densities >=  class3 ~ as.character("group4"),
      TRUE~"U"))

density_df %>%
  group_by(density_class)%>%
  tally()

density_shapes<-c("group0"=3, "group1"=21,"group2"=21, "group3"=21, "group4"=21)

density_sizes<-c("group0"=0.5, "group1"=1,"group2"=2, "group3"=3, "group4"=5)

density_labels<-c('0','> 0-1','> 1-2.5','> 2.5-5','> 5')

ggplot()+
  geom_point(data=density_df,
          aes(x = longitude,
              y= latitude,
              shape = density_class,
              size= density_class),
              fill= "#d00000")+
  
  scale_shape_manual(values = density_shapes,labels=density_labels)+
  scale_size_manual(values =  density_sizes,labels=density_labels)

library(sf)
library(GermanNorthSea)

my_CRS<-4326
Europa<-sf::st_transform(German_land, my_CRS)
EEZ<-sf::st_transform(German_EEZ, my_CRS)
color_land='#f7bf54'
color_water='#3668b4'
xval<-c(3,9)
yval<-c(53,56)

base_plot<-ggplot2::ggplot()+
    # maps
    ggplot2::geom_sf(data = EEZ, colour = 'black', fill = color_water)+
    ggplot2::geom_sf(data = Europa, colour = 'black', fill = color_land)+ 
    ggplot2::coord_sf(xlim = xval, ylim = yval)+

    NULL
base_plot

density_wmap<-base_plot+
  geom_point(data=density_df,
          aes(x = longitude,
              y= latitude,
              shape = density_class,
              size= density_class),
              fill= "#d00000")+
  
  scale_shape_manual(values = density_shapes,labels=density_labels)+
  scale_size_manual(values =  density_sizes,labels=density_labels)
density_wmap

density_wlegend<-add_legend(
  plot_wbreaks=density_wmap,
  legtx=3.0,
  legty=54.0,
  legxy=c(0.11, 0.21),
  xval=xval,
  yval=yval)+
  theme(legend.key.size = ggplot2::unit(0.4, "cm"))
density_wlegend

density_wtheme<-add_theme(plot_wlegend = density_wlegend)
density_wtheme
```


---
## 3.3. Interactive

Graphs can be interactive.

```{r, warning=FALSE,message=FALSE}
#install.packages('plotly')
library(plotly)
```

```{r}
ggplotly(My_plot)
```

---

# 3.4. Animate

```{r}
library(gganimate)
```

```{r, echo=FALSE, out.height=350}
knitr::include_graphics('https://github.com/MiriamLL/miriamlerma_/blob/main/animation.gif?raw=true')
```

---
name: export
background-image: url(https://images.unsplash.com/photo-1465161191540-aac346fcbaff?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=870&q=80)
background-size: cover

# 4. Export

---

# 4. ggsave

To export a plot there is **ggsave**

```{r}
ResultsFolder<-here::here()
```

```{r, eval=FALSE}
ggsave(My_plot, 
       filename = paste0(ResultsFolder,"/My_plot.png"),
       width = 24, 
       height = 24, 
       units = "in",
       dpi = 500)
```


---

name: out
class: title-slide
background-image: url(https://images.unsplash.com/photo-1514679347725-10436adc23a8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=862&q=80)
background-size: cover

### Back to
- [points](#points)
- [lines](#lines)
- [boxplot](#boxplot)
- [maps](#maps)
- [theme](#theme)
- [legend](#legend)
- [export](#export) 

.right[
### Contact
This materials are free of use <br> Download the presentation here: [`r fa("external-link-alt", fill = "#f2cc8f")`github](https://github.com/MiriamLL/R_intro) and  [`r fa("external-link-alt", fill = "#f2cc8f")`webpage](https://www.miriam-lerma.com/posts/2023-06-06-plotting/)
]

.right[

[`r fa("home", fill = '#f2cc8f')`Home](https://www.miriam-lerma.com/teaching.html)

[`r fa("play", fill = '#f2cc8f')` Index ](https://miriamll.github.io/R_intro/Plotting_0606.html#2)

]

<br>

