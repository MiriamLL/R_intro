---
title: "Plotting"
author: "Miriam Lerma"
date: "June 2023"
output:
  xaringan::moon_reader:
    css: RZero-themer.css
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      
---

class: title-slide, bottom, right
background-image: url(https://images.unsplash.com/photo-1542320260-f8f651de8c12?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80)
background-size: cover

### `r rmarkdown::metadata$title`
# `r rmarkdown::metadata$subtitle`

### **`r rmarkdown::metadata$author`**<br>
`r rmarkdown::metadata$date`

---

name: index
class: title-slide, inverse

```{r, echo=FALSE, include = FALSE}
#Paquetes
library(xaringanExtra)
library(kableExtra)
library(fontawesome)
library(emo)
```

# Index

- [rmarkdown](#rmd)
- [read files](#read-files)
- [basic operations](#basic-operations)
- [columns and rows](#column-rows)
- [tidydata](#tidydata)
- [distinct](#distinct) 
- [count](#count)
- [select](#select)
- [filter](#filter) 
- [mutate](#mutate)
- [summarise](#sumarise) 
- [drop_na](#drop)  
- [join](#join) 
- [export](#export) 
- [contact](#out)

---

class: title-slide, inverse

# Today

.pull-left[

**Your profile**
- You know how to use a Rmd document
- You know how to install packages

We will use the packages

```{r,eval=TRUE}
install.packages(tidyverse)
# install.packages("devtools")
devtools::install_github("MiriamLL/sula")
devtools::install_github("MiriamLL/GermanNorthSea")
```

**Goals of today**

- Create plots and maps in R
- Change the apparence of the plots
- Export you plots

**Pauses and questions**

- Exercises and 10 minute pauses for catching up
- You can stop me to ask questions or use [this link `r fa("external-link-alt", fill = "#f2cc8f")`]( https://docs.google.com/document/d/1uG7a2_hkdaKQm5gKXRBFf6gcyoUBan2e69gL3ZKcwg8/edit?usp=sharing)

]

---

class: inverse

# References

-[gg is for Grammar of Graphics](https://pkg.garrickadenbuie.com/trug-ggplot2)<br>
[IntroduccionToGGplot](https://englelab.gatech.edu/useRguide/introduction-to-ggplot2.html)  

---


## 1.1. Theory

The objective of a graph/plot/map is to communicate. <br>
In science, the idea is to show information in a clear and understandable way. 

```{r echo=FALSE, out.height=350}
knitr::include_graphics("http://www.typesofgraphs.com/wp-content/uploads/2015/12/Typesofgraphs.png")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

Plotting is transfor data to visualizations that vary in shape, size and colors.

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_1.jpg")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

There are many ways to plot data, and different ways to interpretate the graphs.

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_2.jpg")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)


---

## 1.1. Theory

Which one is more intuitive?

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_4.jpg")
```

Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

Which one should I use?

You can try different plots and choose the one that betters tells the story.

**Tableau Public** has a suggestion on which graph to use according to the type of data you are using.

```{r echo=FALSE, out.height=300}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_5.jpg")
```

---

name: intro

## 1.2. Intro to ggplot

There are manuy packages to create plots in R.
- Here we will use **ggplot2**.


ggplot is the most versatile one, and from which you can find more help and inspiration.

---

## 1.2. How does it works?

A graph can be divided in three main components:

- **Data** (data): which are the variables that we plot.
- **Geometry** (geom): a geometric object such as dots, lines, bars.
- **Aesthetics** (aes): the aesthetic attributes to a geometric object, such as position, color, shape and size. 
  

In **ggplot** we use **layers**, as in GIS (Geographic information systems).

```{r echo=FALSE, out.height=200}
knitr::include_graphics("https://englelab.gatech.edu/useRguide/images/dataviz/ge_geom.png")
```
  

Fuente: [ggplot2 book](https://englelab.gatech.edu/useRguide/working-with-data-overview.html)

---

## 1.3. Install and load

The package ggplot is already included in tidyverse. If you have installed tidyverse you just need to call your package.

```{r, eval=FALSE}
library(tidyverse)
```

If not you can also install it separately. 
```{r, eval=FALSE}
install.packages("ggplot2")
```

---

## 1.3. Load data

For the exercises, we can use data from packages.
Lets add our object to our **environment**

```{r}
library(palmerpenguins)
penguins<-penguins
```

```{r}
library(ggplot2)
```

```{r, echo=TRUE, eval=FALSE}
ggplot(data=penguins)
```


---

## 1.3. Add axis

```{r, fig.height=3}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))
```


Now the axis are columns from your data frame.

---

## 1.3. Geometry

```{r, fig.height=3}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
       geom_point() #<<
```
  
It would likely show a **warning**
This is because NAs are not going to be plotted and is trying to warn you.

---

## 1.4. Different geometries

There are many, but today we will cover:
-Points<br>
-Lines<br>
-Bars<br>
-Boxplots<br>
-Trajectories<br> 
-Maps<br>  
.
.center[
```{r echo=FALSE, out.height=300}
knitr::include_graphics("http://www.typesofgraphs.com/wp-content/uploads/2015/12/Typesofgraphs.png")
```
]

---
name: points

## 1.4. Points

```{r, fig.height=3}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_point() #<<
```


---
name: lines

## 1.4. Lines

```{r, fig.height=3,warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_line() #<<
```

---

name: Bars

## 1.4. Gráfico de barras

It might be easier to follow the logic as the previous plots, and add only **geom_bar**.
However, we need to tell what do you want inside the bars.
```{r, fig.height=3,warning=FALSE, eval=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_bar() #<<
```
Error: stat_count() can only have an x or y aesthetic.

Therefore we need to write **stat=**
```{r, echo=TRUE, eval=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_bar(stat='identity') #<<
```


---

name: boxplot

## 1.4. Boxplot

For boxplot, we could also follow the previous logic, but it would plot all together.
```{r, fig.height=3, echo=TRUE, warning=FALSE}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_boxplot() #<<
```

Therefore adding the argument **group=* inside mapping, we can create boxplots per group.

```{r, fig.height=3, echo=TRUE, warning=FALSE}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm,y=bill_depth_mm, 
                   group=species))+#<<
  geom_boxplot() 
```

---

name: trajectories

## 1.4. Trajectory

To install the package
```{r}
devtools::install_github("MiriamLL/sula")
```

To load package
```{r}
library(sula)
```

To get data in the environment
```{r}
tracking_data<-GPS_raw
```

To plot, use **geom_path**
```{r, fig.height=3, echo=TRUE, eval=FALSE}
ggplot(data = tracking_data, aes(x = Latitude, y = Longitude)) +
  geom_path() #<<
```

---

name: maps

## 1.4. Maps

Install 

```{r}
devtools::install_github("MiriamLL/GermanNorthSea")
```

Load
```{r}
library(GermanNorthSea)
```

Add to environment
```{r}
German_land<-German_land
```

Plot

Here I have **coord_sf** and some coordinates to **zoom-in**
```{r}
ggplot(German_land)+ 
  geom_sf()+
  coord_sf(xlim = c(3790000,4250000), ylim = c(3350000,3680000))
```



---

class: inverse

# Exercise `r fa("pencil-alt", fill = '#FFFFFF')`

 `r emo::ji("penguin")`

.panelset[
.panel[.panel-name[Datos]
- Carga los datos
```{r}
library(datos)
Pingus<-datos::pinguinos
```
]

.panel[.panel-name[Rellenar]
- Rellena los espacios (*****) para crear un gráfico de puntos el largo del pico y el largo de la aleta.
```{r}
#ggplot(data=***, mapping=aes(x=***,y=***))+
#  geom_***()
```
]

.panel[.panel-name[Respuesta]
```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm))+
  geom_point()
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm))+
  geom_point()
```
```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-41-1.png')
```
]
]


---

name: estetica
class: title-slide, inverse, right, middle
background-image: url(https://images.unsplash.com/photo-1525909002-1b05e0c869d8?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=675&q=80)
background-size:cover

# 2. Estéticas

---

## 2.1. Colores de los símbolos

```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, 
                                color=especie))+ #<<
  geom_point()
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, 
                                color=especie))+
  geom_point()
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-43-1.png')
```

---

## 2.2. Temas

```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw() #<<
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-50-1.png')
```

---

## 2.3. Fondos

```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  theme(panel.background = element_rect(fill = 'darkblue'))#<<
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  theme(panel.background = element_rect(fill = 'darkblue'))
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-47-1.png')
```

---

## 2.4. Modificar ejes

```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  xlab('Largo Pico')+ylab('Largo Aleta')#<<
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  xlab('Largo Pico')+ylab('Largo Aleta')
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-50-1.png')
```


---

## 2.5. Tamaño de letras

```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  theme(axis.title = element_text(size=20)) #<<
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  theme(axis.title = element_text(size=20))
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-52-1.png')
```

---

## 2.6. Leyendas

```{r, echo=TRUE, eval=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  theme(legend.position = "top") #<<
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()+
  theme_bw()+
  theme(legend.position = "top")
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-54-1.png')
```

---

## 2.7 Cheat sheet

Help>CheatSheets>Data Visualization with ggplot

---

## 2.8. Errores comunes

No tener los datos ordenados.  
Noten que para definir los ejes usamos columnas, por lo tanto es importante que tengan sus datos ordenados de esta manera.  
Si no los tienen asi por ahora, lo veremos mas adelante en 'ordenar mis datos'.  

```{r echo=FALSE, out.width=600}
knitr::include_graphics('https://r4ds-en-espaniol.netlify.app/diagrams_w_text_as_path/es/visualization-stat-bar.svg')
```
  
Fuente: [R4DS](https://r4ds-en-espaniol.netlify.app/) 

---

## 2.8. Errores comunes de sintaxis

No poner el **+**
```{r}
#ggplot(data=Pingus, 
#       mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))
#       geom_point()
```

--

Poner el **+** en el lugar incorrecto
```{r}
#ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))
# +geom_point()
```

--

No cerrar paréntesis

```{r}
#ggplot(data=Pingus, mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie)+
# geom_point()
```
Falta un parentesis despues de especie.

---

## 2.9. Grafico como objeto

Se pueden guardar los gráficos como objeto 
```{r, echo=TRUE, eval=FALSE}
MiGrafico<-ggplot(data=Pingus, 
                  mapping=aes(x=largo_pico_mm,y=largo_aleta_mm, 
                              color=especie))+ geom_point()
```

Y agregar estéticas a su gráfico base con el signo de +
```{r, fig.height=3, echo=TRUE, eval=FALSE}
MiGrafico+ #<<
  theme_bw()+
  theme(legend.position = "top")
```


---

## 2.10. Omitir partes

No necesitan escribir todo (data, mapping se puede omitir) si siguen un orden.
```{r, echo=TRUE, eval=FALSE}
MiGrafico<-ggplot(Pingus, 
                  aes(x=largo_pico_mm,y=largo_aleta_mm, 
                              color=especie))+geom_point()
MiGrafico
```

```{r, fig.height=3, echo=FALSE, include=TRUE, warning=FALSE}
ggplot(Pingus, aes(x=largo_pico_mm,y=largo_aleta_mm, color=especie))+
  geom_point()
```

---

class: inverse

# Ejercicios `r fa("pencil-alt", fill = '#FFFFFF')`

- Crear un gráfico de puntos con los datos de diamantes <br>
- Graficar el *precio* por el *quilate* -
- Cambiar el color de lo puntos de acuerdo al *corte* 
- Cambiar el nombre en el eje x por 'Precio en dolares' y el eje y por 'kt'.

.panelset[
.panel[.panel-name[Datos]
- Crear un gráfico de puntos con los datos de diamantes
```{r}
Diamantes<-datos::diamantes
```
]
.panel[.panel-name[Rellenar]
Graficar el *precio* por el *quilate* y cambiar el color de lo puntos de acuerdo al *corte* y cambiar el nombre en el eje x por *Precio en dolares* y el eje y por *kt*.
```{r}
#ggplot(data=***,mapping=aes(x=***, y=***, color=****))+
#  geom_****()+
#  theme_bw()+
#  xlab("**")+ylab("***")
```
]

.panel[.panel-name[Respuesta]
```{r, echo=TRUE, eval=FALSE}
ggplot(data=Diamantes,mapping=aes(x=precio, y=quilate, color=corte))+
  geom_point()+
  theme_bw()+
  xlab("Precio en pesos")+ylab("kt")
```

Gráfico  
```{r, fig.height=2, echo=FALSE, include=TRUE}
ggplot(data=Diamantes,mapping=aes(x=precio, y=quilate, color=corte))+
  geom_point()+
  theme_bw()+
  xlab("Precio en pesos")+ylab("kt")
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-66-1.png')
```
]
]

---
name: exportar
# 3. Exportar

Para exportar tu figura puedes usar la función **ggsave**

```{r, eval=FALSE}
ggsave(Figura, 
       filename = "~/Figura.png",
       width = 24, 
       height = 24, 
       units = "in",
       dpi = 500)
```

---

# 4. Otras posibilidades

.pull-left[
Los gráficos se pueden animar.

```{r, eval=FALSE}
library(gganimate)
library(plotly)
```

```{r, echo=FALSE, out.height=350}
knitr::include_graphics('https://www.datanovia.com/en/wp-content/uploads/dn-tutorials/r-tutorial/images/transition_time.gif')
```
]

.pull-right[


Explorar:

- [Visualizaciones en R](https://www.notion.so/Data-Viz-Bookmarks-dc01718020bd4fd6a8a4ca80e6bce933) by Silvia Canelón (@spcanelon) and Tom Mock (@thomas_mock)  <br>

- Twitter: <br> #tidytuesday <br> #DatosDeMiercoles, #30díasdegráficos <br>

- [RGraphGallery](https://www.r-graph-gallery.com/) <br>

- [DataToViz](https://www.data-to-viz.com/) <br>

- [Coolors](https://coolors.co/) <br>
]

---

class: inverse

# Recapitulando

---

class: title-slide, inverse

# References

- R for Data Science  
[`r fa("book-open", fill = "#f2cc8f")` R4DS](https://r4ds.had.co.nz/)  

- Data Carpentries  
[`r fa("book-open", fill = "#f2cc8f")` Carpentries](https://datacarpentry.org/genomics-r-intro/00-introduction/index.html)

- R cookbook  
[`r fa("book-open", fill = "#f2cc8f")` R cookbook](http://www.cookbook-r.com/)

- From Zero to Shero by RLadies   
[`r fa("github-alt", fill = "#f2cc8f")` Zero to Hero](https://github.com/rladies/meetup-presentations_freiburg) 

- Images from  
[`r fa("camera-retro", fill = "#f2cc8f")` Unsplash](https://unsplash.com/)  
[`r fa("palette", fill = "#f2cc8f")` Allison horst](https://allisonhorst.com/allison-horst)  



---


name: rmd
class: title-slide, inverse, bottom
background-image: url(https://images.unsplash.com/photo-1542319785-59a73ea1c114?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1170&q=80)
background-size: cover

.pull-right[
# `r text_spec("R markdown", background = "#003049", color = "#e5e5e5", bold = T)`
### `r text_spec("Parts of the kitchen", background = "#003049", color = "#e5e5e5", bold = T)`
]

---

## 1. RMarkdown 

Rmarkdown is very convenient because it let us export what we do in R to html or word documents.

We can even make slides... <br>
.right[...like this one.]

--

There are **plenty** of options on Rmd. I will just point out a few.

---





---

name: out
class: title-slide
background-image: url(https://images.unsplash.com/photo-1587246574087-0b56fabf9861?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxzZWFyY2h8MzExfHxob3JuZWFuZG98ZW58MHx8MHx8&auto=format&fit=crop&w=500&q=60)
background-size: cover


### Back to
- [rmarkdown](#rmd)
- [read files](#read-files)
- [basic operations](#basic-operationr)
- [columns and rows](#column-rows)
- [distinct](#distinct) 
- [count](#count)
- [select](#select)
- [filter](#filter) 
- [mutate](#mutate)
- [summarise](#sumarise) 
- [drop_na](#drop)  
- [join](#join) 
- [export](#export) 

.right[
### Contact
This materials are free of use <br> Download the presentation here: [`r fa("external-link-alt", fill = "#f2cc8f")`github](https://github.com/MiriamLL/R_intro) and  [`r fa("external-link-alt", fill = "#f2cc8f")`webpage](https://www.miriam-lerma.com/posts/2023-05-08-data-wrangling/)
]

.right[

[`r fa("home", fill = '#f2cc8f')`Home](https://www.miriam-lerma.com/teaching.html)

[`r fa("play", fill = '#f2cc8f')` Index ](https://miriamll.github.io/R_intro/DataWrangling_0805.html#2)

]

<br>

