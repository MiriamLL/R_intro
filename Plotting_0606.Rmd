---
title: "Plotting"
author: "Miriam Lerma"
date: "June 2023"
output:
  xaringan::moon_reader:
    css: RZero-themer.css
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: true
      
---

class: title-slide, bottom, right
background-image: url(https://images.unsplash.com/photo-1570386230314-9fe8204c6f80?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=1108&q=80)
background-size: cover

### `r rmarkdown::metadata$title`
# `r rmarkdown::metadata$subtitle`

### **`r rmarkdown::metadata$author`**<br>
`r rmarkdown::metadata$date`

---

name: index
class: title-slide, inverse

```{r, echo=FALSE, include = FALSE}
#Paquetes
library(xaringanExtra)
library(kableExtra)
library(fontawesome)
library(emo)
```

# Index

- [points](#points)
- [lines](#lines)
- [boxplot](#boxplot)
- [trajectory](#trajectories)
- [maps](#maps)
- [theme](#theme)
- [legend](#legend)
- [export](#export) 

---

class: title-slide, inverse

# Today

.pull-left[

**Your profile**
- You know how to use a Rmd document
- You know how to install packages


**Goals of today**

- Create plots and maps in R
- Change the apparence of the plots
- Export you plots

**Pauses and questions**

- Exercises and 10 minute pauses for catching up
- You can stop me to ask questions or use [this link `r fa("external-link-alt", fill = "#f2cc8f")`]( https://docs.google.com/document/d/1uG7a2_hkdaKQm5gKXRBFf6gcyoUBan2e69gL3ZKcwg8/edit?usp=sharing)

]

.pull-right[
We will use the packages

```{r,eval=FALSE}
# install.packages('tidyverse')
# install.packages("devtools")
devtools::install_github("MiriamLL/sula")
devtools::install_github("MiriamLL/GermanNorthSea")
```
]

---

class: inverse

# References

Tutorials  

- [gg is for Grammar of Graphics](https://pkg.garrickadenbuie.com/trug-ggplot2)<br>

- [IntroduccionToGGplot](https://englelab.gatech.edu/useRguide/introduction-to-ggplot2.html)  

Galleries/Portafolios

- [Examples of graph on R](https://spcanelon.notion.site/spcanelon/Data-Viz-Bookmarks-dc01718020bd4fd6a8a4ca80e6bce933)<br>

- [RGraphGallery](https://www.r-graph-gallery.com/) <br>

- [DataToViz](https://www.data-to-viz.com/) <br>

- [Coolors](https://coolors.co/) <br>

---


## 1.1. Theory

The objective of a graph/plot/map is to communicate. <br>
In science, the idea is to show information in a clear and understandable way. 

```{r echo=FALSE, out.height=350}
knitr::include_graphics("http://www.typesofgraphs.com/wp-content/uploads/2015/12/Typesofgraphs.png")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

Plotting is transforming data to visualizations that vary in shape, size and colors.

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_1.jpg")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

There are many ways to plot data, and different ways to interpretate the graphs.

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_2.jpg")
```
  
Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)


---

## 1.1. Theory

Which one is more intuitive?

```{r echo=FALSE, out.height=350}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_4.jpg")
```

Fuente:  [VizThinker](https://paldhous.github.io/ucb/2016/dataviz/week2.html)

---

## 1.1. Theory

Which one should I use?

You can try different plots and choose the one that betters tells the story.

**Tableau Public** has a suggestion on which graph to use according to the type of data you are using.

```{r echo=FALSE, out.height=300}
knitr::include_graphics("https://paldhous.github.io/ucb/2016/dataviz/img/class2_5.jpg")
```

---

name: intro

## 1.2. Intro

There are many packages to create plots in R.
- Here we will use **ggplot2**.


ggplot is the most versatile one, and from which you can find more help and inspiration.

---

## 1.2. Intro

A graph can be divided in three main components:

- **Data** (data): which are the variables that we plot.
- **Geometry** (geom): a geometric object such as dots, lines, bars.
- **Aesthetics** (aes): the aesthetic attributes to a geometric object, such as position, color, shape and size. 
  

In **ggplot** we use **layers** as in GIS (Geographic information systems).

```{r echo=FALSE, out.height=200}
knitr::include_graphics("https://englelab.gatech.edu/useRguide/images/dataviz/ge_geom.png")
```
  

Fuente: [ggplot2 book](https://englelab.gatech.edu/useRguide/working-with-data-overview.html)

---

## 1.3. Data

```{r xaringanExtra-clipboard, echo=FALSE}
xaringanExtra::use_clipboard()
```

The package ggplot is already included in tidyverse. <br> If you have installed tidyverse you just need to call your package.

```{r, eval=FALSE}
library(tidyverse)
```

If not you can also install it separately. 
```{r, eval=FALSE}
install.packages("ggplot2")
```

---

## 1.3. Data

For the exercises, we can use data from packages.
Lets add our object to our **environment**

.pull-left[
Package with data
```{r}
library(palmerpenguins)
penguins<-penguins
```

Call library
```{r}
library(ggplot2)
```
]

.pull-right[]
Add data to a plot
```{r, echo=TRUE, fig.width=3, fig.height=6}
ggplot(data=penguins)
```
]

---

## 1.3. Add axis

.pull-left[
We told ggplot what data frame we want to use, but we didnt give instructions on what we want to plot. <br>
**mapping** is where we tell ggplot what to plot in the x and y axis.<br>
Note that the axis are columns from your data frame.
]

.pull-right[
```{r, fig.height=3}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm, #<<
                   y=bill_depth_mm))
```

]

---

## 1.3. Geometry

The next step is to give it a geometry, in this case we say plot points with the argument **geom_point**

  
It would likely show a **warning**
This is because NAs are not going to be plotted and is trying to warn you.

.pull-right[
```{r, fig.height=3}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
       geom_point() #<<
```

]

---

## 1.4. Different geometries

There are many **geometries**

.center[
```{r echo=FALSE, out.height=300}
knitr::include_graphics("http://www.typesofgraphs.com/wp-content/uploads/2015/12/Typesofgraphs.png")
```
]

---
name: points

## 1.4. Points

Description: The point geom is used to create scatterplots. The scatterplot is most useful for displaying the relationship between two continuous variables.

```{r, fig.height=3}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_point() #<<
```


---
name: lines

## 1.4. Lines

Description: **geom_line()** connects observations in order of the variable on the x axis

```{r, fig.height=3,warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_line() #<<
```

---

name: Bars

## 1.4. Bars

Description: geom_bar() makes the height of the bar proportional to the number of cases in each group

It might be easier to follow the logic as the previous plots, and add only **geom_bar**.
However, we need to tell what do you want inside the bars.

```{r, fig.height=3,warning=FALSE, eval=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_bar() #<<
```
Error: stat_count() can only have an x or y aesthetic.

Therefore we need to write **stat=**
```{r, echo=TRUE, eval=FALSE, warning=FALSE}
ggplot(data=penguins,mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_bar(stat='identity') #<<
```


---

name: boxplot

## 1.4. Boxplot

Definition: The boxplot compactly displays the distribution of a continuous variable. It visualises five summary statistics (the median, two hinges and two whiskers), and all "outlying" points individually.

```{r, fig.height=3, echo=TRUE, warning=FALSE}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm,y=bill_depth_mm))+
  geom_boxplot() #<<
```

---

## 1.4. Boxplot

However, mostly likely we want to compare groups. Therefore adding the argument **group=* inside mapping to create boxplots per group.

```{r, fig.height=3, echo=TRUE, warning=FALSE}
ggplot(data=penguins,
       mapping=aes(x=bill_length_mm,y=bill_depth_mm, 
                   group=species))+#<<
  geom_boxplot() 
```

---

name: trajectories

## 1.4. Trajectory

To test this function, load data from the package **sula**
```{r, warning=FALSE}
#devtools::install_github("MiriamLL/sula")
library(sula)
```

Get data in the environment
```{r}
tracking_data<-GPS_raw
```

To plot, use **geom_path**
geom_path() connects the observations in the order in which they appear in the data.

```{r, fig.height=3, echo=TRUE, eval=TRUE}
ggplot(data = tracking_data, aes(x = Latitude, y = Longitude)) +
  geom_path() #<<
```

---

name: maps

## 1.4. Maps

Install **GermanNorthSea**

This package compiles shapefiles from the North Sea

```{r, warning=FALSE}
#devtools::install_github("MiriamLL/GermanNorthSea")
library(GermanNorthSea)
```

Add shapefile to environment
```{r}
German_land<-German_land
```

Plot

```{r}
ggplot(German_land)+ 
  geom_sf()+
  coord_sf(xlim = c(3790000,4250000), ylim = c(3350000,3680000))
```

---

## 1.4. Maps

Here I have **coord_sf** and some coordinates to **zoom-in**
```{r}
ggplot(German_land)+ 
  geom_sf()+
  coord_sf(xlim = c(3790000,4250000), ylim = c(3350000,3680000))
```



---

class: inverse

# Exercise `r fa("pencil-alt", fill = '#FFFFFF')`

 `r emo::ji("penguin")`

.panelset[
.panel[.panel-name[Datos]
- Load data
```{r}
library(palmerpenguins)
penguins<-penguins
```
]

.panel[.panel-name[Rellenar]
- Fill the spaces (*****) to create a plot of bill lenght and body mass.
```{r}
#ggplot(data=***, mapping=aes(x=***,y=***))+
#  geom_***()
```
]]

---

name: aesthetics
class: title-slide, inverse, right, middle
background-image: url(https://images.unsplash.com/photo-1525909002-1b05e0c869d8?ixid=MXwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHw%3D&ixlib=rb-1.2.1&auto=format&fit=crop&w=675&q=80)
background-size:cover

# 2. Aesthetics

---

## 2.1. Symbol color

```{r}
library(ggplot2)
```

```{r, echo=TRUE, warning=FALSE}
ggplot(data=penguins, mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+ #<<
  geom_point()
```


---

## 2.2. Theme

```{r, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+ 
  geom_point()+
  theme_bw() #<<
```

---

## 2.3. Background colors

```{r, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  theme(panel.background = element_rect(fill = 'darkblue'))#<<
```

---

## 2.4. Axis legends

```{r, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  xlab('Bill lenght')+ylab('Flipper length')#<<
```


---

## 2.5. Font size

```{r, echo=TRUE, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  theme(axis.title = element_text(size=20)) #<<
```

---

## 2.6. Legends

```{r, echo=TRUE, warning=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()+
  theme_bw()+
  theme(legend.position = "top") #<<
```

---

## 2.7 Cheat sheet

Help>CheatSheets>Data Visualization with ggplot

---

## 2.8. Common mistakes

Not having **tidydata**  
 

```{r echo=FALSE, out.width=600}
knitr::include_graphics('https://r4ds-en-espaniol.netlify.app/diagrams_w_text_as_path/es/visualization-stat-bar.svg')
```
  
Fuente: [R4DS](https://r4ds-en-espaniol.netlify.app/) 

---

## 2.8. Common mistakes

Forgetting a plus symbol ( **+** )

```{r, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))
  geom_point()
```

--

Adding the **+** on the wrong order
```{r, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))
 +geom_point()
```

--

Forgetting a parethesis

```{r, eval=FALSE}
ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species)+ #<<
         geom_point()
```
Add a parenthesis after "species"

---

## 2.9. Plot as an object

You can save your plot as an object in the environment

```{r, echo=TRUE}
My_plot<-ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+ 
  geom_point()
```

```{r}
My_plot
```

Yo can add aesthetics to the object using the **+**
```{r, fig.height=3, echo=TRUE, eval=FALSE}
My_plot+ #<<
  theme_bw()+
  theme(legend.position = "top")
```


---

## 2.10. Simplify 

So far we always wrote data= and mapping= <br>

However, you can skip it if you follow the same order.

No necesitan escribir todo (data, mapping se puede omitir) si siguen un orden.
```{r, echo=TRUE, eval=FALSE}
My_plot<-ggplot(data=penguins, 
       mapping=aes(x=bill_length_mm,y=flipper_length_mm, 
                                color=species))+
  geom_point()
My_plot
```


---

class: inverse

# Ejercicios `r fa("pencil-alt", fill = '#FFFFFF')`

- Crear un gráfico de puntos con los datos de diamantes <br>
- Graficar el *precio* por el *quilate* -
- Cambiar el color de lo puntos de acuerdo al *corte* 
- Cambiar el nombre en el eje x por 'Precio en dolares' y el eje y por 'kt'.

.panelset[
.panel[.panel-name[Datos]
- Crear un gráfico de puntos con los datos de diamantes
```{r}
Diamantes<-datos::diamantes
```
]
.panel[.panel-name[Rellenar]
Graficar el *precio* por el *quilate* y cambiar el color de lo puntos de acuerdo al *corte* y cambiar el nombre en el eje x por *Precio en dolares* y el eje y por *kt*.
```{r}
#ggplot(data=***,mapping=aes(x=***, y=***, color=****))+
#  geom_****()+
#  theme_bw()+
#  xlab("**")+ylab("***")
```
]

.panel[.panel-name[Respuesta]
```{r, echo=TRUE, eval=FALSE}
ggplot(data=Diamantes,mapping=aes(x=precio, y=quilate, color=corte))+
  geom_point()+
  theme_bw()+
  xlab("Precio en pesos")+ylab("kt")
```

Gráfico  
```{r, fig.height=2, echo=FALSE, include=TRUE}
ggplot(data=Diamantes,mapping=aes(x=precio, y=quilate, color=corte))+
  geom_point()+
  theme_bw()+
  xlab("Precio en pesos")+ylab("kt")
```

```{r echo=FALSE, out.height=300, eval=FALSE}
knitr::include_graphics('https://raw.githubusercontent.com/MiriamLL/Curso_CIAD/main/Figuras/unnamed-chunk-66-1.png')
```
]
]

---
name: export

# 3. Export

To export a plot there is **ggsave**

```{r, eval=FALSE}
ggsave(My_plot, 
       filename = "~/My_plot.png",
       width = 24, 
       height = 24, 
       units = "in",
       dpi = 500)
```

---

# 4. Other options

## 4.1. Interactive

Graphs can be interactive.

```{r, warning=FALSE,message=FALSE}
#install.packages('plotly')
library(plotly)
```

```{r}
ggplotly(My_plot)
```


---

# 4.2. Animate

```{r}
library(gganimate)
```

```{r, echo=FALSE, out.height=350}
knitr::include_graphics('https://www.datanovia.com/en/wp-content/uploads/dn-tutorials/r-tutorial/images/transition_time.gif')
```

---

### Back to
- [points](#points)
- [lines](#lines)
- [boxplot](#boxplot)
- [maps](#maps)
- [theme](#theme)
- [legend](#legend)
- [export](#export) 

.right[
### Contact
This materials are free of use <br> Download the presentation here: [`r fa("external-link-alt", fill = "#f2cc8f")`github](https://github.com/MiriamLL/R_intro) and  [`r fa("external-link-alt", fill = "#f2cc8f")`webpage](https://www.miriam-lerma.com/posts/2023-06-06-plotting/)
]

.right[

[`r fa("home", fill = '#f2cc8f')`Home](https://www.miriam-lerma.com/teaching.html)

[`r fa("play", fill = '#f2cc8f')` Index ](https://miriamll.github.io/R_intro/Plotting_0606.html#2)

]

<br>

